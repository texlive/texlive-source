ASYFILES = $(notdir $(wildcard ../*.asy)) latexusage.asy
SOURCE = ../asymptote.texi ../version.texi ../options
ASY = ../asy -dir ../base -config "" -render=0

docdir = $(DESTDIR)@docdir@
infodir = $(DESTDIR)@infodir@
datarootdir = @datarootdir@
INSTALL = @INSTALL@

all:	html info

%.png:	../%.asy
	cd ..; $(ASY) -f png -o png/ $(notdir $<)

latexusage.png: ../latexusage.eps
	convert -alpha Off -density 144x144 +antialias -geometry 50%x \
		../latexusage.eps latexusage.png

index.html: $(SOURCE) $(ASYFILES:.asy=.png)
	makeinfo --html ../asymptote -o .

asymptote.info: $(SOURCE) $(ASYFILES:.asy=.png)
	makeinfo ../asymptote

html:	index.html

info:	asymptote.info

clean: FORCE
	-rm -f *.png *.html asymptote.info* texput.aux texput.log

distclean:
	-rm -f Makefile

install: 
	${INSTALL} -d -m 755 $(infodir)
	${INSTALL} -p -m 644 asymptote.info $(infodir)
	-${INSTALL} -p -m 644 asymptote.info-* $(infodir)
	-if test -z "$(DESTDIR)"; then \
		install-info --infodir=$(infodir) asymptote.info; \
	fi

uninstall: 
	-install-info --remove --infodir=$(infodir) asymptote.info
	-rm -f $(infodir)/asymptote.info $(infodir)/asymptote.info-*
FORCE:
