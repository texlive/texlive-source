# @configure_input@
# Makefile for teTeX's extra scripts - te@dbs.uni-hannover.de.
# Public domain.

kpse_include ../make/paths.mk
kpse_include ../make/common.mk
kpse_include ../make/programs.mk

man5dir = $(mandir)/man5

SCRIPTS = \
  allcm allneeded dvi2fax dvired fmtutil fmtutil-sys fontinst \
  kpsetool kpsewhere ps2frag ps4pdf pslatex rubibtex rumakeindex \
  texconfig texconfig-dialog texconfig-sys texdoc \
  texlinks updmap updmap-sys

# These scripts do not exist here in /source/ at all, the instances
# in texmf are the masters (except when it is CTAN).
LINKSUFFIX =
LINKED_SCRIPTS = \
  texmf/scripts/a2ping/a2ping.pl \
  texmf/scripts/epstopdf/epstopdf.pl \
  texmf/scripts/pdfcrop/pdfcrop.pl \
  texmf/scripts/pkfix/pkfix.pl \
  texmf/scripts/ps2eps/ps2eps.pl \
  texmf/scripts/tetex/e2pall.pl \
  texmf/scripts/tetex/texdoctk.pl \
  texmf/scripts/texlive/getnonfreefonts.pl \
  texmf-dist/scripts/glossaries/makeglossaries \
  texmf-dist/scripts/perltex/perltex.pl \
  texmf-dist/scripts/texcount/TeXcount.pl \
  texmf-dist/scripts/thumbpdf/thumbpdf.pl \
  texmf-dist/scripts/ppower4/ppower4.texlua \
  texmf-dist/scripts/ppower4/pdfthumb.texlua \
  texmf-dist/scripts/vpe/vpe.pl

LINKED_SYS_SCRIPTS = \
  texmf/scripts/texlive/getnonfreefonts.pl

CONTEXTSCRIPTS = \
  ctxtools exatools luatools makempy mpstools mptopdf mtxtools \
  pdftools pstopdf rlxtools runtools texexec texfont texmfstart \
  textools texutil tmftools xmltools

contextmanpgs = \
  ctxtools makempy mptopdf pstopdf texfind texmfstart \
  fdf2tex pdftools texexec texfont textools texutil

manpgs = \
  allcm allec allneeded dvi2fax dvired e2pall epstopdf fontinst \
  kpsetool kpsewhere mkocp mkofm ofm2opl opl2ofm otp2ocp outocp \
  ovf2ovp ovp2ovf ps2frag pslatex rubibtex rumakeindex texconfig texdoc \
  texdoctk thumbpdf ttf2afm updmap

all: $(SCRIPTS)
default: all

install: install-data install-exec
check:

# Auxiliary files.
install-data::
	$(SHELL) $(top_srcdir)/../mkinstalldirs $(man1dir) $(man5dir) $(texpooldir) $(texmf)/doc/tetex
	for p in $(manpgs); do \
	  $(INSTALL_DATA) $(srcdir)/$$p.man $(man1dir)/$$p.$(manext); \
	done
	for p in $(contextmanpgs); do \
	  $(INSTALL_DATA) $(srcdir)/context/$$p.man $(man1dir)/$$p.$(manext); \
	done
	$(INSTALL_DATA) $(srcdir)/fmtutil.man $(man1dir)/fmtutil.1
	$(INSTALL_DATA) $(srcdir)/texlinks.man $(man1dir)/texlinks.1
	$(INSTALL_DATA) $(srcdir)/fmtutil.cnf.5 $(man5dir)/fmtutil.cnf.5
	$(INSTALL_DATA) $(srcdir)/updmap.cfg.5 $(man5dir)/updmap.cfg.5
	cd $(man1dir); rm -f allec.$(manext) texhash.$(manext) \
	  lambda.$(manext) pdflatex.$(manext) kpsepath.$(manext) \
	  kpsexpand.$(manext) mf-nowin.$(manext) ctangle.$(manext) \
	  cweave.$(manext) odvicopy.$(manext) \
	  odvitype.$(manext) texconfig-sys.$(manext) \
	  updmap-sys.$(manext) mktexfmt.$(manext) fmtutil-sys.$(manext)
	ln -s allcm.$(manext) $(man1dir)/allec.$(manext)
	ln -s mktexlsr.$(manext) $(man1dir)/texhash.$(manext)
	ln -s omega.$(manext) $(man1dir)/lambda.$(manext)
	ln -s pdftex.$(manext) $(man1dir)/pdflatex.$(manext)
	ln -s kpsetool.$(manext) $(man1dir)/kpsepath.$(manext)
	ln -s kpsetool.$(manext) $(man1dir)/kpsexpand.$(manext)
	ln -s mf.$(manext) $(man1dir)/mf-nowin.$(manext)
	ln -s cweb.$(manext) $(man1dir)/ctangle.$(manext)
	ln -s cweb.$(manext) $(man1dir)/cweave.$(manext)
	ln -s dvicopy.$(manext) $(man1dir)/odvicopy.$(manext)
	ln -s dvitype.$(manext) $(man1dir)/odvitype.$(manext)
	ln -s texconfig.$(manext) $(man1dir)/texconfig-sys.$(manext)
	ln -s updmap.$(manext) $(man1dir)/updmap-sys.$(manext)
	ln -s fmtutil.$(manext) $(man1dir)/mktexfmt.$(manext)
	ln -s fmtutil.$(manext) $(man1dir)/fmtutil-sys.$(manext)
	for p in TETEXDOC.pdf TETEXDOC.ps TETEXDOC.dvi teTeX-FAQ; do \
	  $(INSTALL_DATA) $(srcdir)/doc/$$p $(texmf)/doc/tetex; \
	done
	$(SHELL) $(top_srcdir)/../mkinstalldirs $(texmf)/texconfig $(texmf)/texconfig/g $(texmf)/texconfig/v $(texmf)/texconfig/x
	$(INSTALL_DATA) $(srcdir)/texmf/texconfig/g/generic $(texmf)/texconfig/g
	$(INSTALL_DATA) $(srcdir)/texmf/texconfig/v/vt100 $(texmf)/texconfig/v
	$(INSTALL_DATA) $(srcdir)/texmf/texconfig/x/xterm $(texmf)/texconfig/x
	$(INSTALL_DATA) $(srcdir)/texmf/texconfig/README $(texmf)/texconfig
	$(INSTALL_DATA) $(srcdir)/texmf/texconfig/generic $(texmf)/texconfig
	$(INSTALL_SCRIPT) $(srcdir)/tcfmgr $(texmf)/texconfig/tcfmgr
	$(INSTALL_DATA) $(srcdir)/tcfmgr.map $(texmf)/texconfig/tcfmgr.map

install-exec: install-linked-scripts install-linked-sys-scripts
	-$(SHELL) $(srcdir)/../mkinstalldirs $(scriptdir)
	for s in $(SCRIPTS); do \
	  $(INSTALL_SCRIPT) $(srcdir)/$$s $(scriptdir)/$$s; \
	done
	for s in $(CONTEXTSCRIPTS); do \
	  $(INSTALL_SCRIPT) $(srcdir)/context/$$s $(scriptdir)/$$s; \
	done
	cd $(scriptdir) && rm -f allec kpsepath kpsexpand texhash; \
	  ln -s allcm allec; \
	  ln -s kpsetool kpsepath; \
	  ln -s kpsetool kpsexpand; \
	  ln -s mktexlsr texhash
	cd $(scriptdir) && rm -f mktexfmt; ln -s fmtutil mktexfmt

# The idea here is to install the scripts themselves in texmf*/scripts,
# and have bin/arch/foo be a symlink to, say,
# ../../texmf/scripts/foo/foo.pl (for Perl).  That way we save a bit of
# disk space, but more importantly omit duplication, and most
# importantly, make it possible to invoke the same Perl script on
# Windows (via a texlua wrapper).
# 
# The installation into texmf*/scripts is either done by hand; or via
# ctan2tl.  The texlua wrapper for Windows is also done by hand, but
# could/should also be done by ctan2tl.
# 
# By the way, $(scriptdir) here is the binary directory, e.g.,
# bin/i386-linux, not the texmf*/scripts dir.
# 
install-linked-scripts:
	-$(SHELL) $(srcdir)/../mkinstalldirs $(scriptdir)
	# link to the basename, removing any extension, of the source.
	# we downcase for the sake of TeXcount.pl -> texcount.
	# LINKSUFFIX is for -sys, see next target.
	for s in $(LINKED_SCRIPTS); do \
	  target=$(scriptdir)/`basename $$s | sed 's,\.[^/]*$$,,' | tr A-Z a-z`; \
	  target=$$target$(LINKSUFFIX); \
	  rm -f $$target; \
	  ln -s ../../$$s $$target; \
	done

install-linked-sys-scripts:
	$(MAKE) LINKSUFFIX=-sys LINKED_SCRIPTS="$(LINKED_SYS_SCRIPTS)" \
	  install-linked-scripts

kpse_include ../make/clean.mk

config.status: $(srcdir)/configure
	$(SHELL) $(srcdir)/configure --no-create --verbose

Makefile: $(srcdir)/Makefile.in config.status
	$(SHELL) config.status

depend:
