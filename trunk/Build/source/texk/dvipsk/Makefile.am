## Makefile.am for the TeX Live subdirectory texk/ stamp-squeeze/
##
## Copyright (C) 2009 Peter Breitenlohner <tex-live@tug.org>
## You may freely use, modify and/or distribute this file.
##
ACLOCAL_AMFLAGS = -I ../../m4

SUBDIRS = squeeze

INCLUDES = $(KPATHSEA_INCLUDES)
AM_CPPFLAGS = -DUNIX -DKPATHSEA -DNeedFunctionPrototypes -DSHIFTLOWCHARS

bin_PROGRAMS = afm2tfm dvips

afm2tfm_SOURCES = afm2tfm.c

afm2tfm_DEPENDENCIES = $(KPATHSEA_DEPEND)

dvips_SOURCES = \
	bbox.c \
	color.c \
	config.h \
	debug.h \
	dopage.c \
	dosection.c \
	dospecial.c \
	download.c \
	dpicheck.c \
	drawPS.c \
	dviinput.c \
	dvips.c \
	dvips.h \
	emspecial.c \
	finclude.c \
	fontdef.c \
	header.c \
	hps.c \
	loadfont.c \
	output.c \
	papersiz.c \
	paths.h \
	pprescan.c \
	prescan.c \
	protos.h \
	ptexmac.h \
	repack.c \
	resident.c \
	scalewidth.c \
	scanpage.c \
	search.c \
	skippage.c \
	t1part.c \
	t1part.h \
	tfmload.c \
	unpack.c \
	virtualfont.c \
	writet1.c

dvips_DEPENDENCIES = $(KPATHSEA_DEPEND)

LDADD = $(KPATHSEA_LIBS)

## Rebuild libkpathsea
@KPATHSEA_RULE@

dist_man1_MANS = afm2tfm.1 dvips.1

info_TEXINFOS = dvips.texi
dvips_TEXINFOS = contrib/config.proto dvips.help

DISTCLEANFILES = $(DVIS) $(PSS)

prolog_DATA = $(prologues)

dist_prologues = \
	color.lpro \
	crop.lpro \
	finclude.lpro \
	hps.lpro \
	special.lpro \
	tex.lpro \
	texps.lpro

prologdir = ${prefix}/texmf/dvips/base

prologues = $(dist_prologues:.lpro=.pro) texc.pro

texc.lpro: texc.script tex.lpro
	$(SHELL) $(srcdir)/texc.script $(srcdir)/tex.lpro $@

SUFFIXES = .pro .lpro

# The `t[mp]-' business is so that we don't create an empty .pro file,
# if running squeeze fails for some reason.  A dependency on squeeze
# fails here, so we include it below.
.lpro.pro:
	squeeze/squeeze <$< >t-$@ && mv t-$@ $@

# When cross-compiling, EXEEXT for the build and hosts system may differ.
# Thus we depend on the auxiliary file squeeze/stamp-squeeze.
$(prologues): squeeze/stamp-squeeze

squeeze/stamp-squeeze:
	cd squeeze && $(MAKE) $(AM_MAKEFLAGS) stamp-squeeze

EXTRA_DIST = $(dist_prologues) texc.script

CLEANFILES = $(prologues) texc.lpro

## dvips test
##
TESTS = dvips.test pfbincl.test

TESTS_ENVIRONMENT = TEXMFCNF=$(srcdir)/../kpathsea TEXCONFIG=$(srcdir)/testdata
TESTS_ENVIRONMENT += TFMFONTS=$(srcdir)/testdata VFFONTS=$(srcdir)/testdata
TESTS_ENVIRONMENT += TEXFONTMAPS=$(srcdir)/testdata TEXPSHEADERS=$(srcdir)/testdata

EXTRA_DIST += \
	dvips.test \
	pfbincl.test \
	testdata/8r.enc \
	testdata/ad.enc \
	testdata/cmex10.pfb \
	testdata/cmex10.tfm \
	testdata/cmmi10.pfb \
	testdata/cmmi10.tfm \
	testdata/cmr10.pfb \
	testdata/cmr10.tfm \
	testdata/cmsy10.pfb \
	testdata/cmsy10.tfm \
	testdata/cmtt10.pfb \
	testdata/cmtt10.tfm \
	testdata/config.ps \
	testdata/dvipstst.tex \
	testdata/dvipstst.xdv \
	testdata/dvipstst.xps \
	testdata/pfbincl.eps \
	testdata/pfbincl.tex \
	testdata/pfbincl.xdv \
	testdata/pfbincl.xps \
	testdata/psfonts.map \
	testdata/ptmbi.vf \
	testdata/ptmbi8r.tfm \
	testdata/ptmr.vf \
	testdata/ptmr8r.tfm \
	testdata/ptmri.vf \
	testdata/ptmri8r.tfm \
	testdata/special.pro \
	testdata/texc.pro \
	testdata/texps.pro

CLEANFILES += dvipstst.ps missfont.log mtest.ps pfbincl.ps

## Not used
##
EXTRA_DIST += \
	INSTALLATION \
	atari \
	cmfonts.map \
	config.ps \
	contrib/PSTricks \
	contrib/afm-extra \
	contrib/colorsep.lpro \
	contrib/configs \
	contrib/crop.lpr \
	contrib/latex209 \
	contrib/volker \
	contrib/whichinpath \
	cyrfonts.map \
	eufonts.map \
	flib.c \
	hps \
	lafonts.map \
	makefont.c \
	mvs \
	pc \
	psfonts.map \
	reencode \
	tex \
	vmcms \
	vms

# in case of an SVN repository
dist-hook:
	rm -rf `find $(distdir) -name .svn`

## Eventually delete these files
##
EXTRA_DIST += \
	Makefile.in.orig \
	configure.in.orig \
	depend.make \
	depend.mk

