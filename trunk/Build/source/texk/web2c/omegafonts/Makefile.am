## Makefile.am for the TeX Live subdirectory texk/web2c/omegafonts/
##
## Copyright (C) 2009 Peter Breitenlohner <tex-live@tug.org>
## You may freely use, modify and/or distribute this file.
##
INCLUDES =  -I$(top_builddir)/.. -I$(top_srcdir) $(KPATHSEA_INCLUDES)
AM_CFLAGS = $(WARNING_CFLAGS)
AM_YFLAGS = -d -v

proglib = ../lib/lib.a

# Automake automatically uses $(proglib)=../lib/lib.a as dependency.
# This does not work for the configure substitution  $(KPATHSEA_LIBS),
# thus we let $(proglib) artificially depend on $(KPATHSEA_LIBS).
#
# Rebuild $(proglib)
$(proglib): $(KPATHSEA_DEPEND) ${top_srcdir}/lib/*.c
	cd ../lib && $(MAKE) $(AM_MAKEFLAGS)

## Rebuild libkpathsea
@KPATHSEA_RULE@

bin_PROGRAMS =
if OTANGLE
if OMFONTS
bin_PROGRAMS += omfonts
endif OMFONTS
endif OTANGLE
EXTRA_PROGRAMS = omfonts

omfonts_SOURCES = \
	char_routines.c \
	char_routines.h \
	dimen_routines.c \
	dimen_routines.h \
	dvi.h \
	error_routines.c \
	error_routines.h \
	extra_routines.c \
	extra_routines.h \
	font_routines.c \
	font_routines.h \
	header_routines.c \
	header_routines.h \
	ligkern_routines.c \
	ligkern_routines.h \
	list_routines.c \
	list_routines.h \
	manifests.h \
	omfonts.c \
	omfonts.h \
	out_ofm.c \
	out_ofm.h \
	out_routines.c \
	out_routines.h \
	param_routines.c \
	param_routines.h \
	parse_ofm.c \
	parse_ofm.h \
	parser.h \
	pl-parser.y \
	pl-lexer.l \
	print_routines.c \
	print_routines.h

LDADD = $(proglib) $(KPATHSEA_LIBS)

DISTCLEANFILES = pl-parser.output

linked_programs = ofm2opl opl2ofm ovf2ovp ovp2ovf

if OTANGLE
if OMFONTS
install-exec-hook:
	cd $(DESTDIR)$(bindir) && \
	  for f in $(linked_programs); do \
	    rm -f $$f$(EXEEXT) && \
	    $(LN_S) omfonts$(EXEEXT) $$f$(EXEEXT) || exit 1; \
	  done
unistall-hook:
	for f in $(linked_programs); do \
	  rm -f $(DESTDIR)$(bindir)/$$f$(EXEEXT); \
	done
endif OMFONTS
endif OTANGLE

## Tests
##
EXTRA_DIST = omfonts.test specialhex.test

## Test data
##
EXTRA_DIST += tests/Cherokee.pl tests/OCherokee.ovp tests/specialhex.ovp

if OTANGLE
if OMFONTS
TESTS = omfonts.test specialhex.test
endif OMFONTS
endif OTANGLE

DISTCLEANFILES += tests/Cherokee.tfm tests/OCherokee.ofm \
	tests/OCherokee.opl tests/OCherokee.ovf \
	tests/xCherokee.pl tests/xOCherokee.ofm \
	tests/xOCherokee.opl tests/xOCherokee.ovp \
	tests/specialhex.ofm tests/specialhex.opl \
	tests/specialhex.ovf tests/xspecialhex.ofm \
	tests/xspecialhex.opl tests/xspecialhex.ovp

